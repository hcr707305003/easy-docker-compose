[databases]
ai-moments = host=你的pg地址 port=5432 dbname=你的数据库名 pool_size=24 reserve_pool=12

[pgbouncer]
listen_addr = 0.0.0.0
listen_port = 6432

auth_type = scram-sha-256
auth_file = /etc/pgbouncer/userlist.txt

; ===== 池模式 =====
pool_mode = transaction

; ===== 客户端并发（逻辑并发）=====
max_client_conn = 12000

; ===== 真实 PostgreSQL 连接 =====
default_pool_size = 24
reserve_pool_size = 12
reserve_pool_timeout = 5

; ===== 生命周期（释放压力）=====
server_idle_timeout = 20
server_lifetime = 900

; ===== 排队 & 限流保护 =====
query_wait_timeout = 60
client_idle_timeout = 300
client_login_timeout = 20

; ===== TCP 稳定性 =====
tcp_keepalive = 1
tcp_keepidle = 60
tcp_keepintvl = 30
tcp_keepcnt = 5

; ===== 日志（必须克制）=====
log_connections = 0
log_disconnections = 0
log_pooler_errors = 1
stats_period = 60

ignore_startup_parameters = extra_float_digits,search_path